<div class="container">
  <div class="row text-center">
    <div class="col-xs-12">
      <h1 style="text-decoration:underline;">Kennel Dashboard</h1>
    </div>
  </div>
</div>

<div class="container">
  <div class="row text-center">
    <div class="col-xs-6">
      <% if !@reservations.nil? %>
        <h3>Most Booked Runs</h3>
        <%= pie_chart @run_names_and_counts %>
      <% end %>
    </div>
  </div>
</div>

<%= image_tag @kennel.avatar.url(:thumb) if !@kennel.nil? %>
<%#= image_tag @photo.image.url(:thumb) if !@photo.nil? %>
<p><strong>Manager: </strong><%= "#{current_user.first_name.capitalize} #{current_user.last_name.capitalize}" %></p>
<p><strong>Email: </strong><%= current_user.email.capitalize %></p>
<% if !@kennel.nil? %>
    <h3><strong><%= @kennel.name %></strong></h3>
    <p><strong>Address:</strong> <%= @kennel.address %></p>
    <p><strong>City:</strong> <%= @kennel.city %></p>
    <p><strong>State:</strong> <%= @kennel.state %></p>
    <p><strong>Zip:</strong> <%= @kennel.zip %></p>
    <p><strong>Phone:</strong> <%= @kennel.phone %></p>
<% else %>
  <h1>Register a Kennel</h1>
  <%= link_to "Kennel registration", new_kennel_path %>
<% end %>

<br>
<br>

<h3>Search for reservations</h3>
<%= form_tag({controller: 'kennels', action: 'kennel_dashboard'}, method: 'get') do %>
  <%= text_field_tag :reservation_search, nil, placeholder: " Search" %>
  ReservationID<%= radio_button_tag(:search_by, "reservationID", active: true) %>
  Last Name<%= radio_button_tag(:search_by, "customer_last_name") %>
  Email<%= radio_button_tag(:search_by, "customer_email") %>
  Phone<%= radio_button_tag(:search_by, "customer_phone") %>
  <br>
  <%= submit_tag "Submit" %>
<% end %>

<br>
<br>

<% if !@kennel.nil? %>
  <% if !@reservation_search_results.blank? %>
    <h3>Reservation Results</h3>
    <% @reservation_search_results.each do |res| %>
      <%= res[:customer_first_name] %>
      <br>
      <%= res[:customer_last_name] %>
      <br>
      <%= res[:customer_email] %>
      <br>
      <%= res[:customer_phone] %>
      <br>
      <%= link_to "Select", kennel_searched_reservation_path(id: res[:id], kennel_info: {name: @kennel[:name], address: @kennel[:address], city: @kennel[:city], state: @kennel[:state], zip: @kennel[:zip], phone: @kennel[:phone], email: @kennel[:email] } ) %>
      <br>
    <% end %>
  <% else %>
    <h3>No results..</h3>
  <% end %>
<% else %>
  <h3>No results..</h3>
<% end %>

<br>
<br>

<%= month_calendar(attribute: :check_in_date) do |date| %>
  <%= unsanitize_date(date.to_s) %>
  <br>
  <% counter = [] %>
  <% if !@reservations.nil? %>
    <% @reservations.each do |res| %>
      <% @pet_stay_date_range = (res[:check_in_date]..res[:check_out_date]).map{|date| date} %>
      <% if @pet_stay_date_range.include? date %>
        <% counter << res %>
        <%= "â€¢#{res.customer_first_name}" %>
        <br>
      <% end %>
    <% end %>
  <% end %>
  <% if @kennel.nil? %>
    <%= link_to "View details", kennel_reservations_path(reservation_ids: counter, date: unsanitize_date(date.to_s)) %>
  <% else %>
    <%= link_to "View details", kennel_reservations_path(reservation_ids: counter, date: unsanitize_date(date.to_s), kennel_id: @kennel[:id]) %>
  <% end %>
<% end %>
<br>
